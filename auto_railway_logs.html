<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöÄ xBOT Railway Logs - Auto Refresh</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
            background: #0f1419;
            color: #f8f8f2;
            line-height: 1.4;
            overflow-x: hidden;
        }
        
        .header {
            background: #1a1a2e;
            padding: 15px 20px;
            border-bottom: 2px solid #16213e;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        
        .header h1 {
            color: #00d2ff;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 18px;
        }
        
        .status-bar {
            display: flex;
            gap: 20px;
            margin-top: 10px;
            font-size: 12px;
        }
        
        .status-item {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 4px 8px;
            border-radius: 4px;
            background: rgba(255,255,255,0.1);
        }
        
        .status-connected { background: rgba(0, 255, 0, 0.2); }
        .status-error { background: rgba(255, 0, 0, 0.2); }
        .status-warning { background: rgba(255, 165, 0, 0.2); }
        
        .controls {
            background: #16213e;
            padding: 10px 20px;
            border-bottom: 1px solid #2a2a3e;
        }
        
        .controls button {
            background: #00d2ff;
            color: #0f1419;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            margin-right: 10px;
            transition: all 0.2s;
        }
        
        .controls button:hover {
            background: #00b8e6;
            transform: translateY(-1px);
        }
        
        .controls button.active {
            background: #ff6b6b;
        }
        
        .logs-container {
            padding: 20px;
            height: calc(100vh - 140px);
            overflow-y: auto;
        }
        
        .log-entry {
            margin-bottom: 8px;
            padding: 8px 12px;
            border-radius: 4px;
            border-left: 3px solid transparent;
            white-space: pre-wrap;
            word-break: break-word;
        }
        
        .log-info { 
            border-left-color: #00d2ff; 
            background: rgba(0, 210, 255, 0.05);
        }
        
        .log-success { 
            border-left-color: #50fa7b; 
            background: rgba(80, 250, 123, 0.05);
        }
        
        .log-warning { 
            border-left-color: #ffb86c; 
            background: rgba(255, 184, 108, 0.05);
        }
        
        .log-error { 
            border-left-color: #ff5555; 
            background: rgba(255, 85, 85, 0.05);
        }
        
        .log-timestamp {
            color: #6272a4;
            font-size: 11px;
            margin-right: 10px;
        }
        
        .log-message {
            color: #f8f8f2;
        }
        
        .emoji {
            margin-right: 5px;
        }
        
        .auto-scroll-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 210, 255, 0.9);
            color: #0f1419;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .auto-scroll-indicator.visible {
            opacity: 1;
        }
        
        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #1a1a2e;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #00d2ff;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #00b8e6;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>
            <span>üöÄ</span>
            xBOT Railway Logs - Auto Refresh
        </h1>
        <div class="status-bar">
            <div class="status-item status-connected" id="connection-status">
                <span>üü¢</span>
                <span>Connected</span>
            </div>
            <div class="status-item" id="refresh-status">
                <span>üîÑ</span>
                <span>Auto-refresh: ON</span>
            </div>
            <div class="status-item" id="last-update">
                <span>‚è∞</span>
                <span>Last update: --:--</span>
            </div>
        </div>
    </div>
    
    <div class="controls">
        <button id="toggle-refresh" onclick="toggleAutoRefresh()">üîÑ Auto-Refresh: ON</button>
        <button onclick="clearLogs()">üóëÔ∏è Clear Logs</button>
        <button onclick="exportLogs()">üíæ Export Logs</button>
        <button onclick="refreshNow()">‚ö° Refresh Now</button>
    </div>
    
    <div class="logs-container" id="logs-container">
        <div class="log-entry log-info">
            <span class="log-timestamp">[--:--:--]</span>
            <span class="log-message">
                <span class="emoji">üöÄ</span>
                Starting auto-refresh Railway logs interface...
            </span>
        </div>
        <div class="log-entry log-info">
            <span class="log-timestamp">[--:--:--]</span>
            <span class="log-message">
                <span class="emoji">üì°</span>
                This will automatically fetch Railway logs every 10 seconds
            </span>
        </div>
        <div class="log-entry log-info">
            <span class="log-timestamp">[--:--:--]</span>
            <span class="log-message">
                <span class="emoji">‚ú®</span>
                No more manual clicking required!
            </span>
        </div>
    </div>
    
    <div class="auto-scroll-indicator" id="auto-scroll-indicator">
        üìç Auto-scrolling to new logs
    </div>

    <script>
        let autoRefresh = true;
        let refreshInterval;
        let logCount = 0;
        let websocket = null;
        let reconnectInterval = null;
        
        function getCurrentTime() {
            return new Date().toLocaleTimeString('en-US', { 
                hour12: false,
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
        }
        
        function addLogEntry(type, emoji, message) {
            const container = document.getElementById('logs-container');
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            
            const timestamp = getCurrentTime();
            entry.innerHTML = `
                <span class="log-timestamp">[${timestamp}]</span>
                <span class="log-message">
                    <span class="emoji">${emoji}</span>
                    ${message}
                </span>
            `;
            
            container.appendChild(entry);
            logCount++;
            
            // Auto-scroll to bottom
            container.scrollTop = container.scrollHeight;
            
            // Show auto-scroll indicator briefly
            const indicator = document.getElementById('auto-scroll-indicator');
            indicator.classList.add('visible');
            setTimeout(() => indicator.classList.remove('visible'), 2000);
            
            // Keep only last 100 entries to prevent memory issues
            if (logCount > 100) {
                container.removeChild(container.firstElementChild.nextElementSibling.nextElementSibling.nextElementSibling);
                logCount--;
            }
        }
        
                 function connectWebSocket() {
             const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
             const wsUrl = `${protocol}//${window.location.host}`;
             
             websocket = new WebSocket(wsUrl);
             
             websocket.onopen = function() {
                 console.log('üöÄ Connected to Railway log stream');
                 updateConnectionStatus('connected');
                 
                 if (reconnectInterval) {
                     clearInterval(reconnectInterval);
                     reconnectInterval = null;
                 }
             };
             
             websocket.onmessage = function(event) {
                 try {
                     const logEntry = JSON.parse(event.data);
                     const emoji = getEmojiForLogType(logEntry.type);
                     addLogEntry(logEntry.type, emoji, logEntry.message);
                     
                     // Update last refresh time
                     const lastUpdate = document.getElementById('last-update').querySelector('span:last-child');
                     lastUpdate.textContent = `Last update: ${getCurrentTime()}`;
                 } catch (error) {
                     console.error('Error parsing log entry:', error);
                 }
             };
             
             websocket.onclose = function() {
                 console.log('üîå WebSocket connection closed');
                 updateConnectionStatus('disconnected');
                 
                 // Attempt to reconnect
                 if (!reconnectInterval) {
                     reconnectInterval = setInterval(() => {
                         console.log('üîÑ Attempting to reconnect...');
                         connectWebSocket();
                     }, 5000);
                 }
             };
             
             websocket.onerror = function(error) {
                 console.error('WebSocket error:', error);
                 updateConnectionStatus('error');
             };
         }
         
         function updateConnectionStatus(status) {
             const statusEl = document.getElementById('connection-status');
             
             switch (status) {
                 case 'connected':
                     statusEl.className = 'status-item status-connected';
                     statusEl.innerHTML = '<span>üü¢</span><span>Connected</span>';
                     break;
                 case 'disconnected':
                     statusEl.className = 'status-item status-warning';
                     statusEl.innerHTML = '<span>üü°</span><span>Reconnecting...</span>';
                     break;
                 case 'error':
                     statusEl.className = 'status-item status-error';
                     statusEl.innerHTML = '<span>üî¥</span><span>Connection Error</span>';
                     break;
             }
         }
         
         function getEmojiForLogType(type) {
             switch (type) {
                 case 'success': return '‚úÖ';
                 case 'warning': return '‚ö†Ô∏è';
                 case 'error': return '‚ùå';
                 default: return 'üì°';
             }
         }
        
                 function startAutoRefresh() {
             // WebSocket handles real-time updates, but we can still have a heartbeat
             if (refreshInterval) clearInterval(refreshInterval);
             
             refreshInterval = setInterval(() => {
                 if (autoRefresh && websocket && websocket.readyState !== WebSocket.OPEN) {
                     connectWebSocket();
                 }
             }, 10000); // Check connection every 10 seconds
         }
        
        function toggleAutoRefresh() {
            autoRefresh = !autoRefresh;
            const button = document.getElementById('toggle-refresh');
            const status = document.getElementById('refresh-status').querySelector('span:last-child');
            
            if (autoRefresh) {
                button.textContent = 'üîÑ Auto-Refresh: ON';
                button.classList.remove('active');
                status.textContent = 'Auto-refresh: ON';
                startAutoRefresh();
            } else {
                button.textContent = '‚è∏Ô∏è Auto-Refresh: OFF';
                button.classList.add('active');
                status.textContent = 'Auto-refresh: OFF';
                clearInterval(refreshInterval);
            }
        }
        
        function clearLogs() {
            const container = document.getElementById('logs-container');
            container.innerHTML = '';
            logCount = 0;
            addLogEntry('info', 'üóëÔ∏è', 'Logs cleared');
        }
        
        function exportLogs() {
            const container = document.getElementById('logs-container');
            const logs = Array.from(container.children).map(entry => entry.textContent).join('\n');
            
            const blob = new Blob([logs], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `xbot-railway-logs-${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            addLogEntry('success', 'üíæ', 'Logs exported successfully');
        }
        
                 function refreshNow() {
             if (websocket && websocket.readyState === WebSocket.OPEN) {
                 addLogEntry('info', '‚ö°', 'Connection is active - logs streaming in real-time');
             } else {
                 connectWebSocket();
                 addLogEntry('info', '‚ö°', 'Reconnecting to Railway log stream...');
             }
         }
         
         // Initialize
         connectWebSocket();
         startAutoRefresh();
         
         // Add some initial logs
         setTimeout(() => {
             addLogEntry('success', 'üöÄ', 'Railway logs interface ready!');
             addLogEntry('info', 'üì°', 'Connecting to real Railway log stream...');
         }, 500);
    </script>
</body>
</html> 