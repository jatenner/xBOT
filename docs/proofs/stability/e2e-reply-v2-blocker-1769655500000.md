# E2E Reply System V2 Proof - Blocker Report

**Generated:** 2026-01-29 02:58:25 UTC  
**Commit:** 47dd17ad58d3db6ff1d41e147110ef78261fb2d0  
**Phase:** PROVING MODE (MAX_E2E_REPLIES=1)

---

## Step 1: Deployment Verification âœ…

**Command:** `pnpm run verify:sha:both`

**Result:**
```
âœ… Verification passed:
  Both services running SHA: 47dd17ad58d3db6ff1d41e147110ef78261fb2d0
  Both services in executionMode: control
```

**Status:** âœ… **PASS** - Both Railway services on correct commit

---

## Step 2: Planner Decision Generation âœ…

**Command:** `railway run --service xBOT pnpm tsx scripts/ops/run-reply-v2-planner-once.ts`

**Result:**
- Created 1 new queued decision
- decision_id: `644d71d0-8baa-41ea-9eec-527ee8809e30`
- target_tweet_id: `2016696355511816484`
- preflight_status: `ok` âœ…
- preflight_ok: `true` âœ…
- strategy_id: `insight_punch` âœ…
- pipeline_source: `reply_v2_planner` âœ…

**SQL Snapshot:**
```sql
SELECT decision_id, status, pipeline_source, target_tweet_id,
       features->>'preflight_status' AS preflight_status,
       features->>'preflight_ok' AS preflight_ok,
       features->>'strategy_id' AS strategy_id
FROM content_generation_metadata_comprehensive
WHERE decision_id = '644d71d0-8baa-41ea-9eec-527ee8809e30';
```

**Status:** âœ… **PASS** - Planner created queued decision with all required fields

---

## Step 3: Mac Runner Daemon Execution âœ…

**Command:** `MAX_E2E_REPLIES=1 RUNNER_MODE=true RUNNER_PROFILE_DIR=./.runner-profile EXECUTION_MODE=executor HEADLESS=true pnpm run executor:daemon`

**Result:**
- Daemon started successfully
- Decision entered processing
- Status transition: `queued` â†’ `posting`

**Status:** âœ… **PASS** - Daemon running and processing decision

---

## Step 4: Runtime Preflight âœ…

**Result:**
- runtime_preflight_status: `ok` âœ…
- Decision passed runtime preflight check
- Proceeded to generation phase

**Status:** âœ… **PASS** - Runtime preflight passed

---

## Step 5: Generation Phase âŒ **BLOCKER**

**Status Transition:**
- `posting` â†’ `failed`

**Error Message:**
```
PLAN_ONLY generation failed: Generation failed: Invalid reply: too long (>200 chars)
```

**Root Cause:**
The `replyGeneratorAdapter.ts` throws an error at line 230-231 when generated content exceeds 200 characters, preventing `planOnlyContentGenerator.ts` from applying the hard length clamp.

**Evidence:**

1. **Error Location:** `src/ai/replyGeneratorAdapter.ts:230-231`
```typescript
if (replyData.content.length > MAX_REPLY_LENGTH) {
  throw new Error(`Invalid reply: too long (>${MAX_REPLY_LENGTH} chars)`);
}
```

2. **Clamp Implementation:** `src/jobs/replySystemV2/planOnlyContentGenerator.ts:256-273`
   - Clamp function exists and is implemented correctly
   - Never reached because adapter throws first

3. **Decision State:**
   - decision_id: `644d71d0-8baa-41ea-9eec-527ee8809e30`
   - status: `failed`
   - runtime_preflight_status: `ok` âœ…
   - strategy_id: `insight_punch` âœ…
   - error_message: `PLAN_ONLY generation failed: Generation failed: Invalid reply: too long (>200 chars)`

**Fix Required:**

Remove the throw in `replyGeneratorAdapter.ts` and allow `planOnlyContentGenerator.ts` to handle clamping:

```typescript
// src/ai/replyGeneratorAdapter.ts:228-232
// REMOVE THIS CHECK - let planOnlyContentGenerator handle clamping
// ğŸ”’ HARD LENGTH CAP: Use same limit as planOnlyContentGenerator (200 chars, configurable)
// const MAX_REPLY_LENGTH = parseInt(process.env.MAX_REPLY_LENGTH || '200', 10);
// if (replyData.content.length > MAX_REPLY_LENGTH) {
//   throw new Error(`Invalid reply: too long (>${MAX_REPLY_LENGTH} chars)`);
// }
```

**Status:** âŒ **BLOCKER** - Generation fails before clamp can be applied

---

## Step 6: Reward Verification â¸ï¸

**Status:** Not reached - blocked at generation phase

---

## Summary

### âœ… Completed Steps:
1. Deployment verification
2. Planner decision generation
3. Mac Runner daemon execution
4. Runtime preflight check

### âŒ Blocking Condition:
**Single Remaining Blocker:** Length validation in `replyGeneratorAdapter.ts` throws before clamp can be applied.

**Minimal Fix:**
Remove the length check throw in `src/ai/replyGeneratorAdapter.ts:230-231` to allow `planOnlyContentGenerator.ts` to handle clamping.

**Expected Outcome After Fix:**
- Generation succeeds with clamped content
- Decision transitions: `queued` â†’ `posting` â†’ `posted`
- Reward computation proceeds
- E2E proof completes successfully

---

## SQL Evidence

**Failed Decision:**
```sql
SELECT decision_id, status, pipeline_source, target_tweet_id,
       features->>'preflight_status' AS preflight_status,
       features->>'preflight_ok' AS preflight_ok,
       features->>'strategy_id' AS strategy_id,
       features->>'runtime_preflight_status' AS runtime_preflight_status,
       error_message
FROM content_generation_metadata_comprehensive
WHERE decision_id = '644d71d0-8baa-41ea-9eec-527ee8809e30';
```

**Result:**
- decision_id: `644d71d0-8baa-41ea-9eec-527ee8809e30`
- status: `failed`
- runtime_preflight_status: `ok`
- strategy_id: `insight_punch`
- error_message: `PLAN_ONLY generation failed: Generation failed: Invalid reply: too long (>200 chars)`
